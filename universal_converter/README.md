<h2 align="center">Перенос конфигурации сторонних вендоров на NGFW UserGate</h2>
<h3 align="center">(Версия 1.2)</h3>

Программа предназначена для переноса конфигурации с Cisco ASA, Cisco FPR, Check Point, Fortigate на NGFW версий 5, 6 и 7.

<p align="center"><img src="main_image.png"></p>

Программа работает в Ubuntu версии 22.10 или выше.<br>
<b>Обращаем ваше внимание:</b> если вы запускаете данную программу в Ubuntu более старой версии или в другой
разновидности Linux, вы делаете это на свой страх и риск. Компания UserGate в этом случае ничем вам не может помочь.

Для работы программы на зоне интерфейса, используемого для веб-косоли администратора, необходимо включить сервис xml-rpc.
Если используется зона Management, то это делать не надо, так как сервис xml-rpc на интерфейсе Management включён по умолчанию.
Исключением является версия 5. На ней необходимо включить данный сервис на зоне Management.
1. Открыть веб-консоль администратора таким образом: https://<usergate_ip>:8001/?features=zone-xml-rpc
2. В настройках нужной зоны активировать сервис "XML-RPC для управления".

<b>Порядок использования:</b>
1. <b>Экспорт конфигурации:</b><br>
1.1. Скачайте архив <b>universal_converter.zip</b> и распакуйте его. Файл <b>universal_converter</b> сделайте исполняемым.<br>
1.2. Запустите программу <b>universal_converter</b>. Программа выполняется в графической среде. В текущей директории будут созданы
каталоги для хранения всех выгруженных конфигураций и каталоги для конфигураций всех вендоров.<br>
1.3. Выбрать пункт - <b>Экспорт конфигурации</b>.<br>
1.4. Далее выберите вердора, конфигурацию которого экспортируете, и нажмите кнопку "Экспорт".<br>
1.5. Появиться окно, в котором необходимо указать каталог для экспортируемой конфигурации и каталог, куда будут помещены файлы
экспортированной конфигурации в формате UserGate NGFW. После этого данные каталоги будут созданы.<br>
2. <b>Для Cisco FPR:</b><br>
2.1. Переименуйте файл конфигурации Cisco FPR в cisco_fpr.cfg и скопируйте его в каталог data_fpr/<i><имя_которое_вы_задали_на_предыдущем_шаге></i><br>
3. <b>Для Fortigate:</b><br>
3.1. Переименуйте файл конфигурации Fortigate в fortigate.cfg и скопируйте его в каталог data_fg/<i><имя_которое_вы_задали_на_предыдущем_шаге></i><br>
4. После экспорта проверьте вывод программы на предмет обнаруженных ошибок.<br>
5. Можно сохранить лог экспорта в файл export.log. Файл создаётся в выбранном каталоге экспорта конфигурации.<br>
6. <b>Импорт конфигурации:</b><br>
6.1. Перед началом работы на новой версии UserGate NGFW настроить DNS, интерфейс Untrusted (для выхода в интернет),
шлюз, произвести активацию корректным ПИН-кодом. После этого дождаться обновления библиотек и списков.<br>
6.2. Запустить программу <b>universal_converter</b>.<br>
6.3. Выбрать пункт 2 - <b>Импорт конфигурации</b>.<br>
6.4. Программа попросит выбрать каталог для импорта конфигурации, затем появиться окно авторизации.
Проверьте, что у администратора, логин которого используете, в профиле включены разрешения для API. Укажите ip-адрес NGFW и
login/пароль администратора.<br>
6.5. Можно импортировать всю конфигурацию, только выбранную группу разделов или отдельный раздел.<br>
6.6. Если у вас используются собственные сертификаты, то перед импортом необходимо импортировать их или создать с теми же именами.<br>
6.7. Если у Вас используются сервера аутентификации (LDAP, NTLM, RADIUS, TACACS, SAML), то необходимо в первую очередь импортировать
настройки DNS, затем используемые сервера аутентификации и профили аутентификации. После этого ввести пароль в серверах аутентификации,
загрузить keytab-файл, если используется авторизация kerberos и проверить работу данных серверов аутентификации.<br>
6.8. Импорт некоторых разделов конфигурации может идти долго. Не надо думать что "программа зависла". Надо дождаться окончания импорта.<br>
6.9. После импорта проверьте вывод программы на наличие сообщений, выделенных цветом. Исправьте конфигурацию NGFW в соответствие
с рекомендациями.<br>
7. Можно сохранить лог импорта в файл import.log. Файл создаётся в выбранном каталоге импорта конфигурации.<br>

<b>Ограничения:</b>
1. Импортируются только интерфейсы VLAN. Все остальные интерфейсы надо будет настроить руками.<br>
2. На всех версиях (кроме 5) нельзя добавить более 8 полос пропускания в библиотеку. При добавлении большего количества
получим ошибку.<br>
3. <b>Экспорт с Cisco FPR:</b><br>
3.1. Переносятся настройки:
<pre>
- Зоны                  - "Сеть/Зоны"
- Интерфейсы VLAN       - "Сеть/Интерфейсы"
- DHCP-relay            - на интерфейсах VLAN
- Статические маршруты  - "Сеть/Виртуальные маршрутизаторы"
- Списки IP-адресов     - "Библиотеки/IP-адреса"
- Сервисы               - "Библиотеки/Сервисы"
- Access-kists          - "Политики сети/ Межсетевой экран"
</pre>
4. <b>Экспорт с Fortigate:</b><br>
4.1. При экспорте сервисов, поля "iprange" и "fqdn" не переносятся так как не поддерживаются в UG NGFW.<br>
4.2. При экспорте групп пользователей, доменные пользователи не переносятся так как не известно к какому домену они относятся.<br>
4.3. Правила NAT не переносятся так как идеология натирования в UG NGFW очень сильно отличается от Fortigate.<br>
4.4. Правила раздела "config firewall vip" конвертируются в правила DNAT, Порт-форвардинга и балансировки нагрузки. Если в
этих правилах использовались сертификаты, после импорта надо удалить соответствующие правила балансировки нагрузки и в ручную создать
правила reverse-прокси, предварительно загрузив необходимые сертификаты.<br>
4.5. После импорта настроек BGP необходимо в настройках каждого BGP-соседа установить параметры "in/out" в соответствующих
фильтрах BGP-соседей и Routemaps, так как данные параметры невозможно установить посредством API.<br>
4.6. После импорта правил межсетевого экрана необходимо в каждом правиле указать зоны источника/назначения. Создайте необходимое
количество зон и присвойте соответствующую зону каждому интерфейсу.<br>
4.7. Переносятся настройки:
<pre>
- Интерфейсы VLAN                       - "Сеть/Интерфейсы"
- Настройки DNS                         - "Сеть/DNS"
- Настройки шлюзов                      - "Сеть/Шлюзы"
- Статические маршруты                  - "Сеть/Виртуальные маршрутизаторы"
- Настройки BGP                         - "Сеть/Виртуальные маршрутизаторы"
- Настройки NTP                         - "UserGate/Настройки/Настройки времени сервера"
- Серверы аутентификации (LDAP, RADIUS) - "Пользователи и устройства/Серверы аутентификации"
- Группы пользователей                  - "Пользователи и устройства/Группы"
- Локальные пользователи                - "Пользователи и устройства/Пользователи"
- Правила межсетевого экрана            - "Политики сети/Межсетевой экран"
- Правила DNAT и Порт-форвардинга       - "Политики сети/NAT и маршрутизация"
- Правила балансировки нагрузки         - "Политики сети/Балансировка нагрузки"
- Ресурсы веб-портала                   - "Глобальный портал/Веб-портал"
- Списки IP-адресов                     - "Библиотеки/IP-адреса"
- Списки групп IP-адресов               - "Библиотеки/IP-адреса"
- Списки URL                            - "Библиотеки/Списки URL"
- Сетевые сервисы                       - "Библиотеки/Сервисы"
- Группы сетевых сервисов               - "Библиотеки/Группы сервисов"
- Почтовые адреса и профили оповещения  - "Библиотеки/Почтовые адреса"
- Профили оповещений                    - "Библиотеки/Профили оповещений"
- Временные интервалы                   - "Библиотеки/Календари"
</pre>
5. <b>Импорт на версию UG NGFW 5:</b><br>
5.1. На версию 5 не импортируются VLAN-ы, Маршруты, OSPF, BGP.<br>
5.2. При импорте не переносятся группы сервисов и IP-адресов, так как в версии 5 группы не поддерживаются.<br>
5.3. На версию 5 не возможно импортировать содержимое календарей. Содержимое надо добавить руками.<br>
5.4. На версию 5 не возможно импортировать содержимое URL категорий. Содержимое надо добавить руками.<br>
5.5. При импорте правил SNMP, правила v.3 импортируются как v.2<br>
6. <b>Импорт на версию UG NGFW 6:</b><br>
6.1. Конвертер не работает с UG NGFW версии 6 если она старее 6.1.7. В этом случае обновитесь до последней версии 6.<br>
6.2. При импорте не переносятся группы сервисов и IP-адресов, так как в версии 6 группы не поддерживаются.<br>
6.3. При импорте правил SNMP, правила v.3 импортируются как v.2<br>
7. <b>Импорт на версию UG NGFW 7.0:</b><br>
7.1. При импорте правил SNMP, правила v.3 импортируются как v.2<br>
8. <b>Импорт на версию UG NGFW 7.1:</b><br>
8.1. При импорте правил SNMP, правила v.3 импортируются как v.2<br>

<b>Примечание:</b>
1. Если вы импортируете конфигурацию на версию 7, то имена групп, серверов аутентификации, различных профилей, правил,
всех списков библиотеки и всего-всего должны быть ТОЛЬКО в английском регистре. Русские буквы допустимы только в описании.
Перед экспортом, замените русские символы в именах на английские.<br>
2. Начиная с версии 7.1 в именах запрещены многие спец.символы. При экспорте с любой версии будет произведено их удаление.<br>
3. Если существуют правила МЭ с одинаковыми именами, то при конвертации к имени такого правило добавляется номер,
что бы имена были уникальными.<br>
4. Пробелы в начале и конце имён правил, списков и т.д. при конвертации удаляются.<br>
5. При экспорте списков IP-адресов типа "10.10.10.0/24" такой список сохраняется в файл "10.10.10.0_24" так как при переносе
каждый список записывается в отдельный файл, а в файловой системе Linux прямой слэш является разделителем пути к файлу.
Имя самого списка не меняется.<br>
6. Никакие пароли (локальных пользователей,  VPN, серверов аутентификации и т.д.) не переносятся. Необходимо
заново вручную ввести пароль. Это ограничение API - невозможно выгрузить парольную информацию.<br>
7. При импорте интерфейсов VLAN им прописываются IP-адреса из сохранённой конфигурации. Необходимо проследить, чтобы не было
конфликта IP-адресов. В общем случае можно в файле выгруженной конфигурации data_ug/.../Network/Interfaces/config_interfaces.json
поменять ip-адрес на каждом интерфейсе.<br>
8. Сертификаты не экспортируются. Если вы используете собственные сертификаты, необходимо загрузить и сконфигурировать их.<br>
9. После переноса конфигурации, устройству UserGate требуется время для компиляции списков сервисов, ip-листов, правил межсетевого
экрана и т.д.. Во время этого процесса веб-консоль может быть недоступна некоторое время, так как данный процесс требует значительных
вычислительных затрат. Время зависит от количества правил, объёма списков и мощности устройства. Необходимо дождаться завершения процесса.
10. <b>Если вы обнаружили ошибку в програме или у вас что то не получается, пожалуйста, откройте тикет в тех.поддержку компании UserGate.</b><br>

03.04.2024  Исправлена обработка ошибок для Fortigate.
25.03.2024  Исправлена ошибка упаковки IP-адресов.