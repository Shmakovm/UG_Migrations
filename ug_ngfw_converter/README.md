<h2 align="center">Экспорт/импорт конфигурации NGFW UserGate</h2>
<h3 align="center">(Версия 0.3)</h3>

Программа предназначена для переноса конфигурации с NGFW версий 5, 6 и 7 на NGFW версий 5, 6 и 7.

<p align="center"><img src="main_image.png"></p>

Программа работает в Ubuntu версии 22.10 или выше.<br>
<b>Обращаем ваше внимание:</b> если вы запускаете данную программу в Ubuntu более старой версии или в другой
разновидности Linux, вы делаете это на свой страх и риск. Компания UserGate в этом случае ничем вам не может помочь.

Для работы программы на зоне интерфейса, используемого для веб-косоли администратора, необходимо включить сервис xml-rpc.
Если используется зона Management, то это делать не надо, так как сервис xml-rpc на интерфейсе Management включён по умолчанию.
Исключением является версия 5. На ней необходимо включить данный сервис на зоне Management.
1. Открыть веб-консоль администратора таким образом: https://<usergate_ip>:8001/?features=zone-xml-rpc
2. В настройках нужной зоны активировать сервис "XML-RPC для управления".

<b>Порядок использования:</b>
1. Экспорт конфигурации:<br>
1.1. Скачайте архив <b>ug_ngfw_converter.zip</b> и распакуйте его. Файл <b>ug_ngfw_converter</b> сделайте исполняемым.<br>
1.2. Запустите программу <b>ug_ngfw_converter</b>. Программа выполняется в графической среде. В текущей директории будет создан
каталог <b>data</b> для хранения всех выгруженных конфигураций.<br>
1.3. Выбрать пункт - <b>Экспорт конфигурации</b>.<br>
1.4. Далее программа попросит выбрать или ввести название каталога для экспорта конфигурации, затем появиться окно авторизации.
Проверьте, что у администратора, логин которого используете, в профиле включены разрешения для API. Укажите ip-адрес NGFW и
login/пароль администратора.<br>
1.5. Можно экспортировать всю конфигурацию, только выбранную группу разделов или отдельный раздел.<br>
1.6. После экспорта проверьте вывод программы на предмет обнаруженных ошибок. Исправьте текущую конфигурацию NGFW и повторите экспорт.<br>
1.7. Можно сохранить лог в файл export.log. Файл создаётся в выбранном каталоге экспорта конфигурации.<br>
2. Импорт конфигурации:<br>
2.1. Перед началом работы на новой версии UserGate NGFW настроить DNS, интерфейс Untrusted (для выхода в интернет),
шлюз, произвести активацию корректным ПИН-кодом. После этого дождаться обновления библиотек и списков.<br>
2.2. Запустить программу <b>ug_ngfw_converter</b>.<br>
2.3. Выбрать пункт 2 - <b>Импорт конфигурации</b>.<br>
2.4. Программа попросит выбрать каталог для импорта конфигурации, затем появиться окно авторизации.
Проверьте, что у администратора, логин которого используете, в профиле включены разрешения для API. Укажите ip-адрес NGFW и
login/пароль администратора.<br>
2.5. Можно импортировать всю конфигурацию, только выбранную группу разделов или отдельный раздел.<br>
2.6. Если у Вас используются сервера аутентификации (LDAP, NTLM, RADIUS, TACACS, SAML), то необходимо в первую очередь импортировать
настройки DNS, затем используемые сервера аутентификации и профили аутентификации. После этого ввести пароль в серверах аутентификации,
загрузить keytab-файл, если используется авторизация kerberos и проверить работу данных серверов аутентификации.<br>
2.7. После импорта проверьте вывод программы на наличие сообщений, выделенных цветом. Исправьте конфигурацию NGFW в соответствие
с рекомендациями.<br>

<b>Ограничения:</b>
1. Экспортируются настройки всех интерфесов, но импортируются только интерфейсы VLAN. Все остальные надо будет сделать руками.
2. Для версии 5:<br>
2.1. Если вы делаете экспорт из версии 5, то выгрузка из правил доменных пользователей и доменных групп для дальнейшего переноса
возможна только при использовании версии UTM равной 5.0.6.4973. Если у вас версия 4825, поставьте update до версии 4973,
который можно запросить в техподдержке UG.<br>
<b>Не используйте версию 4973 для работы в боевом режиме. Она предназначена только для экспорта конфигурации.</b><br>
2.2. При экспорте Captive-профилей, не экспортируются дата и время окончания регистрации гостевых пользователей.<br>
2.3. Нельзя сделать экспорт/импорт терминальных серверов.<br>
2.4. На версию 5 не импортируются VLAN-ы, Маршруты, OSPF, BGP.<br>
3. Для версии 6:<br>
3.1. Конвертер не работает с UG NGFW версии 6 если она старее 6.1.7. В этом случае обновитесь до последней версии 6.<br>

<b>Примечание:</b>
1. Если вы импортируете конфигурацию на версию 7, то имена групп, серверов аутентификации, различных профилей, правил,
всех списков библиотеки и всего-всего должны быть ТОЛЬКО в английском регистре. Русские буквы допустимы только в описании.
Перед экспортом, замените русские символы в именах на английские.
2. После импорта профилей администраторов, необходимо проверить доступ к разделам, так как в версии 6 и 7 были добавлены
новые разделы. При импорте доступ к разделам не меняется и, следовательно, доступ к новым разделам не предоставляется.
Профили с русскими именами не переносятся в версию 7 (в ней запрещены русские имена). Перед экспортом, замените имена
профилей на английские.
3. Начиная с версии 7.1 в именах запрещены многие спец.символы. При экспорте будет произведено их удаление.
4. Если существуют правила МЭ с одинаковыми именами, то при конвертации к имени такого правило добавляется номер,
что бы имена были уникальными.
5. Пробелы в начале и конце имён правил, списков и т.д. при конвертации удаляются.
6. Имена списков IP-адресов типа "10.10.10.0/24" заменяются на "10.10.10.0_24" так как при переносе каждый список
записывается в отдельный файл с данным именем, а в файловой системе Linux прямой слэш является разделителем пути к файлу.
7. После импорта настроек BGP в свойсвах каждого из bgp-соседей надо заново ввести пароль.
8. Никакие пароли (локальных пользователей, PPPoE, VPN, серверов аутентификации и т.д.) не переносятся. Необходимо
заново вручную ввести пароль. Это ограничение API - невозможно выгрузить парольную информацию.
9. При импорте интерфейсов VLAN им прописываются IP-адреса из сохранённой конфигурации. Необходимо проследить, чтобы не было
конфликта IP-адресов. В общем случае можно в файле выгруженной конфигурации data/Network/Interfaces/config_interfaces.json поменять
ip-адрес на каждом интерфейсе.
10. Раздел Библиотеки "Профили СОВ": не импортируются сигнатуры профилей СОВ так как в разных версиях структура и состав
сигнатур кардинально меняется.
11. Сертификаты экспортируются, но пока не импортируются. Если используется сертификат по умолчанию для SSL инспектирования
(CA Default), то необходимо обновить его у всех пользователей. Если вы используете собственные сертификаты, необходимо загрузить
и сконфигурировать их заново.
12. Правила экспорта настроек на сервера FTP, SSH пока не переносятся. Это надо сделать руками.
13. Если вы обнаружили ошибку в програме или у вас что то не получается, пожалуйста, откройте тикет в тех.поддержку компании UserGate.

<b>В настоящее время реализован экспорт/импорт разделов:</b>
- UserGate
- Сеть
- Пользователи и устройства

остальное в процессе...

